<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£è¯å¿«ä¹ - Merry Christmas</title>
    <style>
        :root {
            --gold: #f0d065;
            --pine-green: #165b33;
            --xmas-red: #d42426; /* æ–°å¢åœ£è¯çº¢ */
        }

        body {
            margin: 0; padding: 0;
            /* èƒŒæ™¯ç¨å¾®è°ƒæš—ä¸€ç‚¹ï¼Œè®©å…‰æ–‘æ›´æ˜æ˜¾ */
            background: radial-gradient(circle at center, #123520, #05120a);
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            overflow: hidden; 
            font-family: "Microsoft YaHei", sans-serif;
            color: white;
            position: relative;
        }

        /* --- æ–°å¢ç‰¹æ•ˆå±‚ï¼šæ¢¦å¹»å…‰æ–‘ (Bokeh) --- */
        #bokeh-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; /* æ”¾åœ¨æœ€åº•å±‚ */
            pointer-events: none;
        }
        .bokeh-light {
            position: absolute;
            border-radius: 50%;
            opacity: 0.2;
            filter: blur(15px); /* é«˜æ–¯æ¨¡ç³Šåˆ¶é€ å…‰æ–‘æ„Ÿ */
            animation: twinkle 6s ease-in-out infinite alternate;
        }
        /* å…‰æ–‘åŠ¨ç”»ï¼šç¼“æ…¢å¿½æ˜å¿½æš— */
        @keyframes twinkle {
            0% { transform: scale(1); opacity: 0.15; }
            100% { transform: scale(1.3); opacity: 0.35; }
        }
        /* å…‰æ–‘é¢œè‰² */
        .bg-red { background: var(--xmas-red); box-shadow: 0 0 20px var(--xmas-red); }
        .bg-gold { background: var(--gold); box-shadow: 0 0 20px var(--gold); }
        .bg-green { background: var(--pine-green); box-shadow: 0 0 20px var(--pine-green); }


        /* --- åŸæœ‰é›ªèŠ±ç”»å¸ƒ (z-index æå‡åˆ°å…‰æ–‘ä¹‹ä¸Š) --- */
        #snow-canvas { 
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; 
            pointer-events: none; 
            z-index: 1; 
        }

        /* --- ä¸­å¤®æ–‡å­—æ ·å¼ä¿®æ”¹ --- */
        .greeting-container {
            z-index: 10;
            text-align: center;
            /* æµ®åŠ¨åŠ¨ç”»ç¨å¾®è°ƒæ…¢ä¸€ç‚¹æ›´ä¼˜é›… */
            animation: float 4s ease-in-out infinite;
        }

        .greeting-container h1 {
            /* ä½¿ç”¨è‰ºæœ¯æ‰‹å†™å­—ä½“æ ˆï¼Œå¦‚æœæ²¡æœ‰åˆ™å›é€€åˆ°æ™®é€šè‰ä¹¦ */
            font-family: "Brush Script MT", "Comic Sans MS", "Segoe Script", cursive;
            font-size: 80px; /* ç¨å¾®åŠ å¤§ */
            margin: 0;
            /* åœ£è¯é…è‰²ï¼šä¸»ä½“çº¢è‰²ï¼Œé…ä¸Šç™½è‰²æè¾¹å’Œé‡‘è‰²å¼ºåŠ›å‘å…‰ */
            color: var(--xmas-red);
            text-shadow: 
                2px 2px 0px #fff, /* ç™½è‰²æè¾¹å¢åŠ ç«‹ä½“æ„Ÿ */
                0 0 20px var(--gold), /* å†…å±‚é‡‘è‰²å…‰æ™• */
                0 0 40px var(--gold), /* å¤–å±‚é‡‘è‰²å…‰æ™• */
                0 0 80px rgba(240, 208, 101, 0.5); /* è¿œæ™¯æ¼«å°„å…‰ */
            letter-spacing: 3px;
            line-height: 1.2;
            /* ç¨å¾®æ—‹è½¬ä¸€ç‚¹ç‚¹è§’åº¦å¢åŠ ä¿çš®æ„Ÿ */
            transform: rotate(-3deg);
        }

        /* å³ä¸Šè§’éŸ³ä¹é€‰æ‹©å™¨ (æ ·å¼ä¿æŒä¸å˜) */
        .music-control {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0, 0, 0, 0.4); padding: 10px 15px;
            border-radius: 20px; border: 1px solid rgba(240, 208, 101, 0.3);
            backdrop-filter: blur(5px); display: flex; align-items: center;
            gap: 10px; transition: opacity 0.3s;
        }
        .music-control:hover { background: rgba(0, 0, 0, 0.6); border-color: var(--gold); }
        .music-control label { font-size: 14px; color: var(--gold); }
        .music-control select { background: transparent; color: white; border: none; outline: none; font-size: 14px; cursor: pointer; }
        #bgm-select { min-width: 120px; }
        #mode-select { min-width: 80px; width: auto;}
        .music-control select option { background-color: #071a10; color: white; }

        /* å³ä¸‹è§’éšè—å…¥å£ (æ ·å¼ä¿æŒä¸å˜) */
        .secret-link {
            position: fixed; bottom: 15px; right: 15px; z-index: 100;
            color: rgba(255, 255, 255, 0.15); text-decoration: none;
            font-size: 12px; transition: all 0.3s; cursor: pointer;
        }
        .secret-link:hover { color: var(--gold); opacity: 1; text-decoration: underline; }

        /* ç®€å•çš„æµ®åŠ¨åŠ¨ç”» */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(-3deg); }
            50% { transform: translateY(-20px) rotate(-3deg); }
        }

        /* ç§»åŠ¨ç«¯é€‚é…è°ƒæ•´ */
        @media (max-width: 768px) {
            .greeting-container h1 { font-size: 50px; }
            .music-control { flex-direction: column; align-items: flex-end; gap: 5px; }
        }
    </style>
</head>
<body>

    <div id="bokeh-container"></div>

    <canvas id="snow-canvas"></canvas>

    <div class="music-control">
        <label>ğŸµ BGM</label>
        <select id="bgm-select" onchange="changeMusic(this.value)"></select>
        <select id="mode-select" onchange="changeMode(this.value)">
            <option value="single">å•æ›²å¾ªç¯</option>
            <option value="list">åˆ—è¡¨å¾ªç¯</option>
        </select>
    </div>

    <div class="greeting-container">
        <h1>ğŸ„ Merry Christmas ğŸ„</h1>
    </div>

    <a href="./draw.html" class="secret-link">Secret Entrance</a>

    <audio id="audio-player"></audio>

<script>
    // ================= æ–°å¢ç‰¹æ•ˆï¼šç”ŸæˆèƒŒæ™¯å…‰æ–‘ =================
    function createBokehEffect() {
        const container = document.getElementById('bokeh-container');
        const colors = ['bg-red', 'bg-gold', 'bg-green'];
        const count = 35; // å…‰æ–‘æ•°é‡

        for (let i = 0; i < count; i++) {
            const light = document.createElement('div');
            light.classList.add('bokeh-light');
            // éšæœºåˆ†é…ä¸€ç§é¢œè‰²
            light.classList.add(colors[Math.floor(Math.random() * colors.length)]);
            
            // éšæœºå¤§å° (30px åˆ° 100px)
            const size = Math.random() * 70 + 30 + 'px';
            light.style.width = size;
            light.style.height = size;
            
            // éšæœºä½ç½®
            light.style.left = Math.random() * 100 + 'vw';
            light.style.top = Math.random() * 100 + 'vh';
            
            // éšæœºåŠ¨ç”»å»¶è¿Ÿå’Œæ—¶é•¿ï¼Œè®©é—ªçƒä¸åŒæ­¥
            light.style.animationDelay = Math.random() * 5 + 's';
            light.style.animationDuration = Math.random() * 4 + 4 + 's';

            container.appendChild(light);
        }
    }
    // ç«‹å³æ‰§è¡Œ
    createBokehEffect();


    // ================= ä»¥ä¸‹æ˜¯åŸæœ‰çš„éŸ³ä¹å’Œé›ªèŠ±é€»è¾‘ (ä¿æŒä¸å˜) =================

    // èƒŒæ™¯éŸ³ä¹åˆ—è¡¨
    const musicList = [
        { path: './audio/jingle-bells.mp3', name: 'Jingle Bells' },
        { path: './audio/å¹¿ä¸œäººçš„åœ£è¯æ­Œ.mp3', name: 'å¹¿ä¸œäººçš„åœ£è¯æ­Œ' },
    ];

    const audioPlayer = document.getElementById('audio-player');
    const bgmSelect = document.getElementById('bgm-select');
    const modeSelect = document.getElementById('mode-select');
    let currentMode = 'single';
    let currentIndex = 0;

    musicList.forEach((music, index) => {
        const option = document.createElement('option');
        option.value = music.path;
        option.text = music.name;
        bgmSelect.appendChild(option);
    });

    function playByIndex(index) {
        if (index < 0 || index >= musicList.length) return;
        currentIndex = index;
        const music = musicList[currentIndex];
        audioPlayer.src = music.path;
        bgmSelect.value = music.path;
        updateLoopAttribute();
        audioPlayer.play().then(() => {
            console.log("æ’­æ”¾æˆåŠŸ: " + music.name);
        }).catch(e => {
            console.log("è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆª");
        });
    }

    function changeMusic(path) {
        const index = musicList.findIndex(m => m.path === path);
        if (index !== -1) playByIndex(index);
    }

    function changeMode(mode) {
        currentMode = mode;
        updateLoopAttribute();
    }

    function updateLoopAttribute() {
        if (currentMode === 'single') {
            audioPlayer.loop = true;
        } else {
            audioPlayer.loop = false;
        }
    }

    audioPlayer.addEventListener('ended', () => {
        if (currentMode === 'list') {
            let nextIndex = (currentIndex + 1) % musicList.length;
            playByIndex(nextIndex);
        }
    });

    window.addEventListener('load', () => {
        if (musicList.length > 0) playByIndex(0);
    });

    let hasInteracted = false;
    document.body.addEventListener('click', () => {
        if (!hasInteracted) {
            if (audioPlayer.paused && audioPlayer.src) audioPlayer.play();
            hasInteracted = true;
        }
    });


    // é›ªèŠ±ç‰¹æ•ˆé€»è¾‘
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d');
    let w, h, flakes = [];

    function initSnow() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        flakes = Array.from({length: 120}, () => ({
            x: Math.random() * w,
            y: Math.random() * h,
            r: Math.random() * 3 + 1,
            d: Math.random()
        }));
    }

    function drawSnow() {
        ctx.clearRect(0, 0, w, h);
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        flakes.forEach(f => {
            ctx.moveTo(f.x, f.y);
            ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
            f.y += Math.pow(f.d, 2) + 1; 
            if (f.y > h) {
                f.y = -10;
                f.x = Math.random() * w;
            }
        });
        ctx.fill();
        requestAnimationFrame(drawSnow);
    }

    window.addEventListener('resize', initSnow);
    initSnow();
    drawSnow();

</script>
</body>
</html>